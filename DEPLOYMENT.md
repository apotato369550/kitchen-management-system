# Deployment Guide - Render

This guide walks through deploying the Kitchen Management System to Render.

## Prerequisites

- GitHub account with the repository pushed
- Render account (free tier available at https://render.com)
- No credit card required for free tier

## Step 1: Prepare Your Repository

### 1.1 Install Updated Dependencies Locally
```bash
pip install -r requirements.txt
```

This installs the new production packages:
- `gunicorn` - Production WSGI server
- `whitenoise` - Static file serving
- `dj-database-url` - Database URL parsing

### 1.2 Test Locally
```bash
DEBUG=False ALLOWED_HOSTS=localhost python manage.py runserver
```

Verify the app starts without errors.

### 1.3 Commit Configuration Files
```bash
git add requirements.txt kitchen_management_system/settings.py build.sh render.yaml
git commit -m "Add Render deployment configuration"
git push origin main
```

The following files are now in your repository:
- `requirements.txt` - Updated with production dependencies
- `kitchen_management_system/settings.py` - Updated for Render
- `build.sh` - Deployment build script
- `render.yaml` - Infrastructure as Code configuration

## Step 2: Create Render Account & Connect GitHub

### 2.1 Sign Up on Render
1. Go to https://render.com
2. Click "Sign up" and choose GitHub authentication
3. Authorize Render to access your GitHub account

### 2.2 Grant Repository Access
1. After signing in, go to Account Settings → GitHub
2. Click "Connect repository"
3. Select the `kitchen-management-system` repository
4. Grant access

## Step 3: Deploy Using Blueprint (render.yaml)

### 3.1 Create New Blueprint
1. On Render dashboard, click **"New +"** (top right)
2. Select **"Blueprint"**
3. Paste your repository URL:
   ```
   https://github.com/YOUR_USERNAME/kitchen-management-system
   ```
4. Click "Connect"

### 3.2 Review Configuration
Render will read `render.yaml` and show you the services to be created:
- **Web Service**: `kitchen-management-system` (Python 3.12, free tier)
- **PostgreSQL Database**: `kitchen_db` (free tier)

The configuration includes:
- Build command: `./build.sh` (installs dependencies, collects static files, runs migrations)
- Start command: `gunicorn kitchen_management_system.wsgi:application`
- Environment variables: AUTO-CONFIGURED

### 3.3 Deploy
1. Click **"Deploy"**
2. Watch the deployment progress in the logs
3. Wait for status to change to **"Live"** (typically 5-10 minutes)

## Step 4: Post-Deployment Setup

### 4.1 Access Your App
Once deployed, your app is live at:
```
https://kitchen-management-system.onrender.com
```

(The exact URL depends on the name in `render.yaml`)

### 4.2 Admin User (Auto-Created)

An admin user is automatically created during deployment with:
- **Username**: `admin`
- **Email**: `admin@example.com`
- **Password**: Auto-generated and secure (shown in Render environment variables)

To view the auto-generated password:
1. Go to your web service on Render
2. Click **"Environment"** tab
3. Look for the `ADMIN_PASSWORD` variable
4. Copy the auto-generated value

### 4.3 Access Django Admin
1. Navigate to: `https://kitchen-management-system.onrender.com/admin/`
2. Log in with:
   - Username: `admin`
   - Password: (the auto-generated `ADMIN_PASSWORD` from environment variables)
3. Manage data through the admin panel

### 4.4 Change Admin Credentials (Optional)

If you want different username/email/password:
1. Go to your web service on Render
2. Click **"Environment"** tab
3. Edit:
   - `ADMIN_USERNAME` - Change the username
   - `ADMIN_EMAIL` - Change the email
   - `ADMIN_PASSWORD` - Change the password (or let Render generate a new one)
4. Click **"Save"** to redeploy
5. The new admin user will be created on next deployment (only if none exists)

## Step 5: Environment Variables (If Needed)

The `render.yaml` automatically sets:
- `DEBUG = False` (production mode)
- `SECRET_KEY` - Auto-generated by Render (secure)
- `ALLOWED_HOSTS` - Set to your Render domain
- `DATABASE_URL` - Auto-set to the PostgreSQL database
- `ADMIN_USERNAME` - Default: `admin` (set during build)
- `ADMIN_EMAIL` - Default: `admin@example.com` (set during build)
- `ADMIN_PASSWORD` - Auto-generated by Render (secure)

If you need to add or modify environment variables:

1. Go to the web service settings on Render
2. Click **"Environment"**
3. Add/edit variables as needed
4. Click **"Save"** (triggers auto-redeploy)

## Step 6: Database Management

### View Database Credentials
1. Go to your PostgreSQL database on Render
2. Click **"Info"** tab
3. See connection string and credentials

### Migrate Data (if switching from Supabase)
The `build.sh` automatically runs migrations on each deploy. If you need to manually migrate:

1. Open Render Shell (on web service)
2. Run: `python manage.py migrate`

### Backup Your Database
Render free tier databases are not automatically backed up. To backup:

1. Use `pg_dump` from Render Shell:
   ```bash
   pg_dump $DATABASE_URL > backup.sql
   ```

## Troubleshooting

### Issue: Deployment Fails
**Check the logs:**
1. Go to web service page
2. Click **"Logs"** tab
3. Look for error messages
4. Common issues:
   - Missing environment variables → Add in settings
   - Database migration errors → Check `build.sh` permissions
   - Import errors → Verify all dependencies in `requirements.txt`

### Issue: Static Files Not Serving
**Solution:** WhiteNoise should handle this automatically, but verify:
1. `build.sh` ran successfully (check logs)
2. `STATIC_ROOT` is set in settings.py
3. Re-deploy to trigger static file collection:
   - Make a commit and push to main
   - Render auto-deploys

### Issue: Can't Login / Admin Not Working
**Solution:**
1. Verify admin credentials:
   - Go to web service on Render
   - Click **"Environment"** tab
   - Check `ADMIN_USERNAME` and `ADMIN_PASSWORD` values
   - Copy the exact password (no spaces)
2. If admin user doesn't exist:
   - Update `ADMIN_PASSWORD` environment variable (or let Render generate a new one)
   - Click **"Save"** to trigger redeploy
   - After deployment completes, the admin user will be created automatically
3. If you need to change credentials:
   - Edit `ADMIN_USERNAME`, `ADMIN_EMAIL`, `ADMIN_PASSWORD` in Environment
   - Click **"Save"** and redeploy
   - Note: Admin user only gets created once; to change it, manually delete the old user via database

### Issue: Database Connection Error
**Check:**
1. DATABASE_URL is set (verify in Environment settings)
2. Database still exists (check PostgreSQL page)
3. Test connection in Render Shell:
   ```bash
   python manage.py dbshell
   ```

## Continuous Deployment

After initial setup, deployment is automatic:

1. Make changes locally
2. Commit and push to `main` branch:
   ```bash
   git add .
   git commit -m "Your message"
   git push origin main
   ```
3. Render automatically:
   - Pulls latest code
   - Runs `build.sh`
   - Restarts the service

**Note:** Avoid pushing secrets or `.env` files. Render won't use them anyway since environment variables are configured in the dashboard.

## Monitoring & Logs

### View Real-Time Logs
1. Go to web service page
2. Click **"Logs"** tab
3. See real-time application output

### Check Service Health
1. Go to web service page
2. Click **"Info"** tab
3. See:
   - Current status (Live/Suspended/Failure)
   - Last deploy time
   - Resource usage

### Restart Service
If needed, click **"Restart"** on the web service page.

## Switching Back to Development

To temporarily disable production features:

1. Set `DEBUG=True` in Environment variables
2. Set `ALLOWED_HOSTS=*` in Environment variables
3. Click **"Save"** to redeploy

**Never do this on production!** Only for testing.

## Next Steps

1. Set up a custom domain (optional):
   - Go to web service settings → Custom Domain
   - Add your domain (e.g., kitchen.yourcompany.com)

2. Set up alerts (optional):
   - Account Settings → Notifications
   - Get alerts for deployment failures, etc.

3. Monitor costs:
   - Free tier is zero cost with limitations
   - See pricing page for paid tiers if needed

## Support

For Render-specific issues:
- Render Docs: https://render.com/docs
- Django + Render guide: https://render.com/docs/deploy-django
- Support: support@render.com

For application issues:
- Check Django logs in Render Shell
- Review application code
- Test locally first before deploying
